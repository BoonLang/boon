-- Minimal test case for checkbox sharing bug
-- Two items with independent checkboxes - clicking one should NOT affect the other

store: [
    items: LIST {
        make_item(name: TEXT { Item A })
        make_item(name: TEXT { Item B })
    }
]

FUNCTION make_item(name) {
    [
        checkbox_link: LINK
        name: name
        checked: False |> HOLD state {
            checkbox_link.event.click |> THEN {
                state |> Bool/not()
            }
        }
    ]
}

document: Document/new(root: Element/stripe(
    element: []
    direction: Column
    gap: 10
    style: [padding: 20]
    items: store.items |> List/map(item, new: Element/stripe(
        element: []
        direction: Row
        gap: 10
        style: []
        items: LIST {
            Element/checkbox(
                element: [event: [click: LINK]]
                style: []
                label: Hidden[text: item.name]
                checked: item.checked
                icon: item.checked |> WHEN {
                    True => TEXT { [X] }
                    False => TEXT { [ ] }
                }
            ) |> LINK { item.checkbox_link }
            Element/label(
                element: []
                style: []
                label: item.name
            )
            Element/label(
                element: []
                style: []
                label: item.checked |> WHEN {
                    True => TEXT { (checked) }
                    False => TEXT { (unchecked) }
                }
            )
        }
    ))
))
