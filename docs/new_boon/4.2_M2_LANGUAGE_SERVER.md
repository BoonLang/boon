# Milestone 2: Language Server

**Status**: Not Started

## Overview

Add a language server to the Boon playground that provides inline type annotations and rich error messages. The LSP runs in a WebWorker, written in Rust and compiled to WebAssembly.

---

## Success Criteria

- [ ] Type annotations appear inline in CodeMirror editor
- [ ] Type checker catches type errors with clear ariadne-style messages
- [ ] LSP runs in WebWorker (non-blocking)
- [ ] Hover shows inferred types for any expression
- [ ] Real-time feedback as user types

---

## Dependencies

- **Requires**: M1 (New Engine) - evaluator provides runtime semantics
- **Enables**: Better developer experience, catches bugs early

---

## Relationship with M1 (Type System Gap)

**Important clarification:** M1 does NOT implement type inference or type checking. M1 is purely a runtime engine.

**What M1 provides to M2:**
- Working evaluator that defines runtime semantics
- NodeKind enum with clear node structure
- Message/Payload types that define runtime values
- Understanding of how LATEST, HOLD, WHEN, WHILE, etc. behave

**What M2 builds from scratch:**
- Type inference algorithm
- Type representation (`Type` enum)
- Unification/constraint solving
- Type error reporting
- LSP integration

**Architecture:**

```
┌─────────────────────────────────────────────────────────────────┐
│ M1: Runtime Engine                                               │
│ - Evaluates AST to produce runtime values                       │
│ - No type annotations, no type checking                         │
│ - Dynamic typing (Payload can hold any value)                   │
└─────────────────────────────────────────────────────────────────┘
                              ↓
                    Runtime semantics inform
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│ M2: Type System + Language Server                               │
│ - Implements type inference (bidirectional)                     │
│ - Implements type checking                                       │
│ - Maps AST nodes to inferred types                              │
│ - Reports type errors                                           │
│ - LSP protocol for editor integration                           │
└─────────────────────────────────────────────────────────────────┘
```

**Why this separation:**
- M1 focuses on correctness of reactive execution
- Type system is orthogonal to runtime behavior
- M2 can start once M1 semantics are stable (don't need M1 fully complete)
- Allows parallel development if resources available

---

## Key Features

| Feature | Description |
|---------|-------------|
| Inline types | Types displayed after variable names in editor |
| Type errors | Red squiggles and error panel with suggestions |
| WebWorker LSP | Non-blocking analysis in background thread |
| Hover info | Show type on mouse hover |
| Go to definition | Jump to variable/function definitions |

---

## Testing Strategy

- Unit tests for type inference engine
- Integration tests with sample Boon programs
- Visual tests comparing expected vs actual inline types
- Error message quality tests (clear, actionable)

---

## Related Documentation

- §2.9 Type System - type inference rules
- §2.10 Language Server - LSP architecture
- §3.2 Hot Reload - type changes during reload
