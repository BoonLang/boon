# Milestone 9: Testing Framework (Cross-Platform)

**Status**: Not Started

## Overview

Extend the CLI testing from M0 to work across all platforms (browser, server, FPGA simulator). This milestone focuses on platform-specific test runners and the Boon-native `TEST {}` syntax for writing tests in Boon code.

**Note:** Basic CLI testing (`boon test`) is established in M0. This milestone adds browser playground integration, FPGA simulation testing, and the full Boon-native test syntax.

---

## Success Criteria

- [ ] Boon-native test syntax (`TEST { }` blocks) implemented
- [ ] Tests run in browser playground (test panel UI)
- [ ] Tests run in FPGA simulator (digitaljs)
- [ ] Test reporter with pass/fail/skip counts
- [ ] Visual test feedback in browser
- [ ] CI integration for all platforms

**Already in M0:** CLI test runner (`boon test`), basic assertions

---

## Dependencies

- **Requires**: M0 (Boon CLI), M1 (New Engine)
- **Enables**: Higher confidence for all other milestones

---

## Key Features

| Feature | Description |
|---------|-------------|
| Cross-platform | Same tests run on all platforms |
| Built-in assertions | `Assert/equals`, `Assert/true`, etc. |
| Test discovery | Automatic test finding in `.bn` files |
| Test isolation | Each test runs independently |
| Async support | Tests can involve timers, events |
| Property testing | Optional: generate random inputs |

---

## Test Syntax (Proposed)

```boon
# Simple test
test_addition: TEST {
    result: 1 + 2
    Assert/equals(result, 3)
}

# Test with setup
test_counter: TEST {
    counter: [count: 0] |> HOLD state {
        increment |> THEN { [count: state.count + 1] }
    }

    # Simulate button press
    increment: TEST/trigger()

    Assert/equals(counter.count, 1)
}

# Test async behavior
test_interval: TEST {
    ticks: 0 |> HOLD state {
        Duration[milliseconds: 100] |> Timer/interval() |> THEN { state + 1 }
    }

    TEST/wait(350)  # Wait 350ms

    Assert/equals(ticks, 3)
}
```

---

## Platform Adapters

| Platform | Test Runner | Notes |
|----------|-------------|-------|
| CLI | `boon test *.bn` | Fastest, for development |
| Browser | Playground test panel | Visual feedback |
| Server | `boon test --server` | Tests server-specific APIs |
| FPGA | `boon test --fpga` | Uses digitaljs simulation |

---

## Testing Infrastructure

```
┌─────────────────────────────────────────────────────────────┐
│                     Test Discovery                          │
│              (Find TEST blocks in .bn files)                 │
└─────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────┐
│                    Test Executor                            │
│         (Run tests with isolation, capture results)          │
└─────────────────────────────────────────────────────────────┘
                            │
            ┌───────────────┼───────────────┐
            ▼               ▼               ▼
      ┌─────────┐     ┌─────────┐     ┌─────────┐
      │   CLI   │     │ Browser │     │  FPGA   │
      │ Runner  │     │ Runner  │     │  Sim    │
      └─────────┘     └─────────┘     └─────────┘
```

---

## Built-in Assertions

| Function | Description |
|----------|-------------|
| `Assert/equals(a, b)` | Check equality |
| `Assert/not_equals(a, b)` | Check inequality |
| `Assert/true(x)` | Check boolean true |
| `Assert/false(x)` | Check boolean false |
| `Assert/contains(list, item)` | Check list membership |
| `Assert/matches(str, pattern)` | Regex match |
| `Assert/throws({ code })` | Expect FLUSH error |

---

## Test Utilities

| Function | Description |
|----------|-------------|
| `TEST/trigger()` | Create a manually-triggered event |
| `TEST/wait(ms)` | Wait for time to pass |
| `TEST/advance(ms)` | Advance virtual time (no real wait) |
| `TEST/mock(api, value)` | Mock an API function |

---

## Testing Strategy

- Start with CLI runner (simplest)
- Add browser integration (playground test panel)
- Add FPGA simulation support
- Add property-based testing (optional)

---

## Related Documentation

- §3.4 Testing - original testing infrastructure design
- M0 - CLI provides `boon test` command and basic assertions
- M3 - FPGA tests use digitaljs simulation
