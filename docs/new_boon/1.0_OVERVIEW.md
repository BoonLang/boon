# Boon Complete Redesign: From Reactive Runtime to RISC Softcore

## Ultimate Vision

**Design and implement a RISC softcore processor entirely in Boon.**

This document set extends the arena-based engine redesign (§2-3) with FPGA synthesis capabilities (§5.1) and culminates in a full RISC-V softcore implementation (§5.2).

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          BOON LANGUAGE                                       │
│                    Reactive Dataflow Programming                             │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
              ┌─────────────────────┴─────────────────────┐
              ▼                                           ▼
┌─────────────────────────────┐           ┌─────────────────────────────┐
│   BROWSER / SERVER / CLI    │           │      FPGA / ASIC            │
│   (Arena-Based Engine)      │           │   (HDL Transpiler)          │
│                             │           │                             │
│   §2-3:                     │           │   §5.1: Transpiler          │
│   - Arena memory model      │           │   - Boon → SystemVerilog    │
│   - Message-passing         │           │   - Type inference          │
│   - Event loop              │           │   - Elaboration             │
│   - Persistence             │           │                             │
│   - Multi-threading         │           │   §5.2: RISC Softcore       │
│   - Live updates            │           │   - RV32I implementation    │
│   - Testing infrastructure  │           │   - Pipeline stages         │
│                             │           │   - Memory interface        │
└─────────────────────────────┘           └─────────────────────────────┘
```

---

## Reading Order

1. **Overview**: This file (1.0)
2. **Getting Started**: 1.1 - Executive summary
3. **Architecture Rationale**: 2.0 - Why sync event loop (not async), why FIFO, old engine problems
4. **Core Engine** (Chapter 2): §2.1-2.8
5. **Runtime Features** (Chapter 3): §3.1-3.7
6. **Milestones** (Chapter 4): §4.0-4.9
7. **Hardware Targets** (Chapter 5): §5.1-5.3
8. **Reference** (Chapter 6): §6.1-6.7

---

## File Index

### Chapter 1: Overview

| File | Description |
|------|-------------|
| `1.0_OVERVIEW.md` | This file |
| `1.1_GETTING_STARTED.md` | Executive summary, constraints, architecture |

### Chapter 2: Core Engine

| File | Section | Description |
|------|---------|-------------|
| `2.0_ARCHITECTURE_RATIONALE.md` | §2.0 | Why sync event loop, not async; why FIFO; old engine problems |
| `2.1_NODE_IDENTIFICATION.md` | §2.1 | SourceId, ScopeId, NodeAddress |
| `2.2_ARENA_MEMORY.md` | §2.2 | Arena, SlotId, ReactiveNode |
| `2.3_MESSAGE_PASSING.md` | §2.3 | Message, Payload, routing |
| `2.4_EVENT_LOOP.md` | §2.4 | EventLoop, timer queue |
| `2.5_GRAPH_SNAPSHOT.md` | §2.5 | Serialization, persistence |
| `2.6_ERROR_HANDLING.md` | §2.6 | FLUSH error handling |
| `2.7_MULTI_THREADING.md` | §2.7 | WebWorkers, SharedArrayBuffer |
| `2.8_BRIDGE_API.md` | §2.8 | Bridge & API architecture |
| `2.9_TYPE_SYSTEM.md` | §2.9 | Fully inferred type system, constraint-based inference |
| `2.10_LANGUAGE_SERVER.md` | §2.10 | In-browser LSP, inline types, diagnostics |

### Chapter 3: Runtime Features

| File | Section | Description |
|------|---------|-------------|
| `3.1_MODULES.md` | §3.1 | Modules, virtual filesystem, multi-renderer |
| `3.2_HOT_RELOAD.md` | §3.2 | Hot reload, state migration |
| `3.3_CROSS_PLATFORM.md` | §3.3 | Browser, server, CLI platforms |
| `3.4_TESTING.md` | §3.4 | Native testing infrastructure |
| `3.5_DIAGNOSTICS.md` | §3.5 | Runtime diagnostics (boon-console), graph inspection |
| `3.6_STATE_EVOLUTION.md` | §3.6 | DRAIN+DRAINING state migration, cross-domain transfers |
| `3.7_HOT_RELOAD_FLEXIBILITY.md` | §3.7 | Hot-reload flexibility, matching strategies, gotchas |

### Chapter 4: Milestones

| File | Section | Description |
|------|---------|-------------|
| `4.0_MILESTONES_OVERVIEW.md` | §4.0 | Milestone summary, dependencies, progression |
| `4.01_M0_BOON_CLI.md` | §4.01 | M0: Standalone CLI runtime |
| `4.1_M1_NEW_ENGINE.md` | §4.1 | M1: Playground on new arena-based engine |
| `4.2_M2_LANGUAGE_SERVER.md` | §4.2 | M2: Inline types, WebWorker LSP, type checker |
| `4.3_M3_FPGA_TRANSPILER.md` | §4.3 | M3: Boon → SystemVerilog, digitaljs, FPGA |
| `4.4_M4_SUPER_COUNTER.md` | §4.4 | M4: Distributed super-counter app |
| `4.5_M5_MULTI_FILE_MODULES.md` | §4.5 | M5: Virtual FS, modules, BUILD.bn, RayBox |
| `4.6_M6_RISC_V_DESIGN.md` | §4.6 | M6: RISC-V processor in Boon |
| `4.7_M7_RISC_V_RUNTIME.md` | §4.7 | M7: Boon on RISC-V via WAMR, MRAM |
| `4.8_M8_KAVIK_CZ.md` | §4.8 | M8: kavik.cz with RayBox, accessibility, SEO |
| `4.9_PHASES.md` | §4.9 | Implementation phases for M1 |
| `4.10_M9_TESTING.md` | §4.10 | M9: Cross-platform testing (browser, FPGA) |
| `4.11_M10_BOON_CONSOLE.md` | §4.11 | M10: Full boon-console (builds on M4) |
| `4.12_M11_SERVO_RAYBOX.md` | §4.12 | M11: Desktop app with boon-console |
| `4.13_M12_PERFORMANCE.md` | §4.13 | M12: Performance optimization |

### Chapter 5: Hardware Targets

| File | Section | Description |
|------|---------|-------------|
| `5.1_FPGA_TRANSPILER.md` | §5.1 | Boon → SystemVerilog transpiler |
| `5.2_RISC_SOFTCORE.md` | §5.2 | RISC-V softcore in Boon |
| `5.3_FIXED_SIZE.md` | §5.3 | Fixed-size philosophy (future consideration) |

### Chapter 6: Reference

| File | Section | Description |
|------|---------|-------------|
| `6.1_ISSUES.md` | §6.1 | Known issues, corrections, design decisions |
| `6.2_EXAMPLES.md` | §6.2 | Playground examples compatibility matrix |
| `6.3_FILES.md` | §6.3 | Critical files, risks, success criteria |
| `6.4_NOTES.md` | §6.4 | Architecture comparison notes |
| `6.5_SYNC.md` | §6.5 | Documentation sync needed |
| `6.6_ROADMAP.md` | §6.6 | Complete roadmap |
| `6.7_OPEN_QUESTIONS.md` | §6.7 | Architectural decisions log |
| `6.8_PROTOCOLS.md` | §6.8 | Value serialization, debug protocol, communication |

---

## Quick Reference

| Old Name | New Name | Section |
|----------|----------|---------|
| Part 1 | Chapter 2.1 | Node Identification |
| Part 2 | Chapter 2.2 | Arena Memory |
| Part 3 | Chapter 2.3 | Message Passing |
| Part 4 | Chapter 2.4 | Event Loop |
| Part 5 | Chapter 2.5 | Graph Snapshot |
| Part 6 | Chapter 2.6 | Error Handling |
| Part 7 | Chapter 2.7 | Multi-Threading |
| Part 8 | Chapter 2.8 | Bridge & API |
| Part 9 | Chapter 3.1 | Modules |
| Part 10 | Chapter 3.2 | Hot Reload |
| Part 11 | Chapter 3.3 | Cross-Platform |
| Part 12 | Chapter 3.4 | Testing |
| Part 13 | Chapter 5.1 | FPGA Transpiler |
| Part 14 | Chapter 5.2 | RISC Softcore |
| Part 15 | Chapter 5.3 | Fixed Size |
| Part 16 | Chapter 2.9 | Type System |
| Part 17 | Chapter 2.10 | Language Server |
| Part 18 | Chapter 3.5 | Runtime Diagnostics |
| Part 19 | Chapter 3.6 | State Evolution |
| Part 20 | Chapter 3.7 | Hot-Reload Flexibility |

---

## Issue Reference

Issues are documented in `6.1_ISSUES.md`. Reference format: `Issue N` (e.g., Issue 1, Issue 26).

---

## Terminology Glossary

**Consistent terms across all documentation:**

| Term | Definition | Notes |
|------|------------|-------|
| **NodeAddress** | Full identifier: `(domain, source_id, scope_id, port)` | Used for message routing |
| **SourceId** | Stable structural hash + parse_order | Computed at parse time |
| **ScopeId** | Hash of scope path (runtime instantiation context) | Propagated through function calls, list items |
| **SlotId** | Arena index + generation | Runtime-only, not persisted |
| **Handle** | Synonym for SlotId in Payload context | `ObjectHandle`, `ListHandle` |
| **Flushed** | Error wrapper in Payload enum | `Payload::Flushed(inner)` |
| **Port** | Which input/output of a node | `Output`, `Input(n)`, `Field(id)` |
| **Domain** | Execution location | `Main`, `Worker(n)`, `Server` |
| **Tick** | One complete propagation cycle | Nodes settle, effects execute |
| **Quiescence** | State when no dirty nodes remain | Tick completes at quiescence |
| **Dirty** | Node has pending input to process | Added to `dirty_nodes` queue |
| **Effect** | Side effect (console.log, navigation) | Queued, executed after tick |
| **Wire** | Connection between nodes | Conceptually a data path |
| **Bus** | Dynamic collection (List node) | Hardware: shared bus pattern |
| **Router** | Object node (demultiplexer) | Projects fields to subscribers |
| **Register** | HOLD node (state holder) | D flip-flop equivalent |
| **Combiner** | LATEST node (merge inputs) | Emits when any input changes |
| **Transformer** | THEN node (map function) | Emits on input arrival |
| **SwitchedWire** | WHILE node (pattern switch) | Routes based on match |
| **PatternMux** | WHEN node (pattern match) | Emits first matching arm |
| **IOPad** | Event source node | DOM events, LINK targets |
| **Bridge** | Arena → UI rendering | Browser-specific |
| **Arena** | Memory pool for nodes | Generational indices |
| **PASS** | Context passing at call site | `function(PASS: value)` |
| **PASSED** | Context access in function | `PASSED.store.items` |
| **FLUSH** | Error propagation | Unwinds through dataflow |
| **AllocSite** | Factory for list item keys | Monotonic counter per append site |
| **ItemKey** | Stable list item identity | From AllocSite, persisted |

**Deprecated terms (avoid using):**

| Old Term | Preferred Term |
|----------|----------------|
| "reference" (for SlotId) | "handle" or "slot" |
| "schedule" (for queueing) | "enqueue" or "mark dirty" |
| "instance_id" | "scope_id" or "item_key" |
| "error union" | "Flushed wrapper" |
| "node reference" | "SlotId" or "NodeAddress" |

---
